## 测试和性能

- 编写单元测试来验证代码的正确性
- 使用 httptest 来模拟基于 HTTP 的请求和响应
- 使用示例代码来给包写文档
- 通过基准测试来检查性能

使用 Go 语言的测试 框架，可以在开发的过程中就进行单元测试和基准测试。
和go build命令类似，go test命 令可以用来执行写好的测试代码，需要做的就是遵守一些规则来写测试。

### 单元测试
- 单元测试是用来测试包或者程序的一部分代码或者一组代码的函数。
- 测试的目的是确认目标 代码在给定的场景下，有没有按照期望工作。

- 一个场景是正向路经测试，就是在正常执行的情况 下，保证代码不产生错误的测试。
- 另外一些单元测试可能会测试负向路径的场景，保证代码不仅会产生错误，而且是预期的错误。

#### 基础单元测试
基础测试(basic test)只使用一组参数和结果来测试一段代码。

#### 表组测试
表组测试(table test)也会测试一段代码，但是会使用多组参数和结果进行测试。
表组测试除了会有一组不同的输入值和期望结果之外，其余部分都很像基础单元测试。 
测试会依次迭代不同的值，来运行要测试的代码。
每次迭代的时候，都会检测返回的结果。

这便 于在一个函数里测试不同的输入值和条件。

#### 模仿调用
- 不能总是假设运行测试的机器可以访问互联网。
- 此外，依赖不属于你的或者你无法操作的服 务来进行测试，也不是一个好习惯。

这两点会严重影响测试持续集成和部署的自动化。
如果突然断网，导致测试失败，就没办法部署新构建的程序。

为了修正这个问题，标准库包含一个名为 httptest 的包，它让开发人员可以模仿基于 HTTP 的网络调用。
模仿(mocking)是一个很常用的技术手段，用来在运行测试时模拟访问不 可用的资源。

#### 测试服务端点
服务端点(endpoint)是指与服务宿主信息无关，用来分辨某个服务的地址，一般是不包含宿主的一个路径。
如果在构造网络API，你会希望直接测试自己的服务的所有服务端点，而不用启动整个网络服务。

包 httptest 正好提供了做到这一点的机制。

### 基准测试
基准测试是一种测试代码性能的方法。
- 想要测试解决同一问题的不同方案的性能，以及查看哪种解决方案的性能更好时，基准测试就会很有用。
- 基准测试也可以用来识别某段代码的 CPU或者内存效率问题，而这段代码的效率可能会严重影响整个应用程序的性能。
- 许多开发人员会用 基准测试来测试不同的并发模式，或者用基准测试来辅助配置工作池的数量，以保证能最大化系统的吞吐量。

### 小结
- 测试功能被内置到 Go 语言中，Go 语言提供了必要的测试工具。
- go test工具用来运行测试。
- 测试文件总是以_test.go 作为文件名的结尾。
- 表组测试是利用一个测试函数测试多组值的好办法。
- 包中的示例代码，既能用于测试，也能用于文档。
- 基准测试提供了探查代码性能的机制。
