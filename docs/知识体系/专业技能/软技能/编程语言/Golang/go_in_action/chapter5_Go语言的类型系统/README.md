## Go语言的类型系统

- 声明新的用户定义的类型
- 使用方法，为类型增加新的行为
- 了解何时使用指针，何时使用值
- 通过接口实现多态
- 通过组合来扩展或改变类型
- 公开或者未公开的标志符

Go 语言是一种静态类型的编程语言。这意味着，编译器需要在编译时知晓程序里每个值的类型。
值的类型给编译器提供两部分信息:第一部分，需要分配多少内存给这个值(即值的规模); 第二部分，这段内存表示什么。

### 用户定义的类型

- 当用户声明一个新类型时，这个声明就给编译器提供了一个框架，告知必要的内存大小和表示信息。
- Go语言里声明用户定义的类型有两种方法。

#### 关键字 struct
结构类型通过组合一系列固定且唯一的字段来声明。
结构里每个字段 都会用一个已知类型声明。
这个已知类型可以是内置类型，也可以是其他用户定义的类型。

- 声明一个结构类型
```go
// user在程序里定义一个用户类型 
type user struct {
	name string
	email string
	ext int
	privileged bool
}

// admin需要一个user类型作为管理者，并附加权限
type admin struct {
	person user
	level string
}

//声明admin类型的变量
fred := admin{
	person: user{
		name: "Lisa",
		email: "lisa@email.com",
		ext: 123,
		privileged: true,
},
    level: "super",
}
```

#### 基于一个已有的类型，将其作为新类型的类型说明

- 基于 `int64` 声明一个新类型
```go
type Duration int64
```

虽然 `int64` 类型是基础类型，Duration类型依然是一个独立的类型。两种不同类型的值即便互相兼容，也不能互相赋值。编译器不会对不同类型的值做隐式转换。

### 方法

方法能给用户定义的类型添加新的行为。
方法实际上也是函数，只是在声明时，在关键字func和方法名之间增加了一个参数。
[listing11.go](./listing11.go)

### 类型的本质
在声明一个新类型之后，声明一个该类型的方法之前，需要先回答一个问题:这个类型的本"质是什么。
程序内部传递这个类型的值的方式:是按值做传递，还是按指针做传递。
这个背后的原则是，不要只关注某个方法是如何处理这个值，而是要关注这个值的本质是什么。

#### 内置类型
- 内置类型是由语言提供的一组类型。
- 这些类型本质上是原始的类型，分别是数值类型、字符串类型和布尔类型。
- 因此，当对这些值进行增加或者删除的时候，会创建一个新值。

基于这个结论，当把这些类型的值传递给方法或者函数时，应该传递一个对应值的副本。

#### 引用类型
Go语言里的引用类型有如下几个:切片、映射、通道、接口和函数类型。
- 当声明上述类型的变量时，创建的变量被称作标头(header)值。
- 每个引用类型创建的标头值是包含一个指向底层数据结构的指针。
- 每个引用类型还包含一组独特的字段，用于管理底层数据结构。

标头值里包含一个指针，因此通过复制来传递一个引用类型的值的副本，本质上就是在共享底层数据结构。

#### 结构类型
结构类型可以用来描述一组数据值，这组值的本质即可以是原始的，也可以是非原始的。

是使用值接收者还是指针接收者，不应该由该方法是否修改了接收到的值来决定。这个决策应该基于该类型的本质。
这条规则的一个例外是，需要让类型值符合某个接口的时候，即便类型的本质是非原始本质的，也可以选择使用值接收者声明方法。

### 接口
多态是指代码可以根据类型的具体实现采取不同行为的能力。

#### 标准库
标准库 `io` 和 `bytes` 使用 
[listing34.go](./listing34.go)

#### 实现
接口是用来定义行为的类型。
这些被定义的行为不由接口直接实现，而是通过方法由用户定义的类型实现。
对接口值方法的调用会执行接口值里存储的用户定义的类型的值对应的方法。

#### 方法集
方法集定义了接口的接受规则。
[listing36.go](./listing36.go)

#### 多态
[listing48.go](./listing48.go)

### 嵌入类型
- Go 语言允许用户扩展或者修改已有类型的行为。
- 这个功能是通过嵌入类型(type embedding)完成的。
- 嵌入类 型是将已有的类型直接声明在新的结构类型里。
- 被嵌入的类型被称为新的外部类型的内部类型。

### 公开或未公开的标识符
要想设计出好的API，需要使用某种规则来控制声明后的标识符的可见性。
Go 语言支持从包里公开或者隐藏标识符。
在这种情况，需要一种方法，将这些标识符声明为包外不可见，这时需要将这些标识符声明为未公开的。

### 小结
- 使用关键字 struct 或者通过指定已经存在的类型，可以声明用户定义的类型。
- 方法提供了一种给用户定义的类型增加行为的方式。
- 设计类型时需要确认类型的本质是原始的，还是非原始的。
- 接口是声明了一组行为并支持多态的类型。
- 嵌入类型提供了扩展类型的能力，而无需使用继承。
- 标识符要么是从包里公开的，要么是在包里未公开的。